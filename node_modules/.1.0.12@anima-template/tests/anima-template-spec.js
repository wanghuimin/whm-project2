var expect = require('expect.js'),
    template = require('../index');

describe('template', function() {
    it('变量替换', function() {
        expect(template('I am <%=name%>, and i like playing <%=man.game%>.', {
            name: 'ziluo',
            man: {
                game: 'basketball'
            }
        })).to.equal('I am ziluo, and i like playing basketball.')
    });

    it('逻辑处理', function() {
        expect(template('I am <%=name%><%if(man){%> and i like playing <%=man.game%><%}%>.', {
            name: 'ziluo',
            man: null
        })).to.equal('I am ziluo.')
    })

    it('分号BUG', function() {
        var tpl = '<% if(searchList) { %>' +
            '<%searchList.info.forEach(function(item){%>' +
            '<li class="thin-line-a">' +
            '<h4 class="am-ft-md hall-list-title-wrap">' +
            '<i class="icon-search"></i>' +
            '<div class="hall-list-title"><%=item.titile%></div>' +
            '</h4>' +
            '<div class="hall-list-content-wrap">' +
            '<i class="icon-search"></i>' +
            '<div class="hall-list-content"><%=item.content%></div>' +
            '</div>' +
            '</li>' +
            '<%})%>' +
            '<h1>hello world</h1>' +
            '<%}%>';

        var data = {
            "msg": "",
            "result": {
                "token": "121212abc",
                "searchType": "1",
                "hasMore": true,
                "info": [{
                    "titile": "密码是什么1",
                    "content": "密码是什么",
                    "historySearchTimes": 0,
                    "id": 998634,
                    "indexId": "_ext_998634_1122",
                    "questionType": "4",
                    "displayRecAnswerFlag": "false"
                }, {
                    "titile": "密码是什么2",
                    "content": "我要找密码",
                    "historySearchTimes": 0,
                    "id": 1133478,
                    "indexId": "_ext_1133478_1122",
                    "questionType": "4",
                    "displayRecAnswerFlag": "false"
                }, {
                    "titile": "密码是什么3",
                    "content": "密码被锁",
                    "historySearchTimes": 0,
                    "id": 1043639,
                    "indexId": "_ext_1043639_1122",
                    "questionType": "4",
                    "displayRecAnswerFlag": "false"
                }]
            },
            "stat": "ok"
        };

        var result = '<li class="thin-line-a"><h4 class="am-ft-md hall-list-title-wrap"><i class="icon-search"></i><div class="hall-list-title">密码是什么1</div></h4><div class="hall-list-content-wrap"><i class="icon-search"></i><div class="hall-list-content">密码是什么</div></div></li><li class="thin-line-a"><h4 class="am-ft-md hall-list-title-wrap"><i class="icon-search"></i><div class="hall-list-title">密码是什么2</div></h4><div class="hall-list-content-wrap"><i class="icon-search"></i><div class="hall-list-content">我要找密码</div></div></li><li class="thin-line-a"><h4 class="am-ft-md hall-list-title-wrap"><i class="icon-search"></i><div class="hall-list-title">密码是什么3</div></h4><div class="hall-list-content-wrap"><i class="icon-search"></i><div class="hall-list-content">密码被锁</div></div></li><h1>hello world</h1>';

        expect(template.compile(tpl).render({
            'searchList': data.result
        })).to.equal(result)
    })

});
